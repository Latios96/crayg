https://github.com/jakubcerveny/gilbert/blob/master/ports/gilbert.c